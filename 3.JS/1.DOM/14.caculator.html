<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>계산기</title>
    <style>
      .calculator {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-gap: 10px;
        max-width: 300px;
        font-size: 18px;
        text-align: center;
        margin: auto;
      }
      .calculator > input {
        grid-column: span 4;
        padding: 10px;
      }
      .calculator > button {
        padding: 10px;
      }
      .calculator > p {
        grid-column: span 4;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div class="calculator">
      <input id="result" type="text" value="0" />
      <button onclick="clickSymbol(this)">+</button>
      <button onclick="clickSymbol(this)">-</button>
      <button onclick="clickSymbol(this)">*</button>
      <button onclick="clickSymbol(this)">/</button>

      <button onclick="clickNumber(this)">7</button>
      <button onclick="clickNumber(this)">8</button>
      <button onclick="clickNumber(this)">9</button>
      <button onclick="clickSymbol(this)">=</button>

      <button onclick="clickNumber(this)">4</button>
      <button onclick="clickNumber(this)">5</button>
      <button onclick="clickNumber(this)">6</button>
      <button onclick="clickSymbol(this)">C</button>

      <button onclick="clickNumber(this)">1</button>
      <button onclick="clickNumber(this)">2</button>
      <button onclick="clickNumber(this)">3</button>
      <button onclick="clickNumber(this)">0</button>
      <p id="errorMessage"></p>
    </div>
    <script>
      //TODO: 예외처리 마무리하기
      // 0으로 나누기, 음수 관련, 창을 넘어가는 수(지수 표현), 소수점 관련 등

      // 버튼 요소
      const buttonElems = document.getElementsByTagName('button');

      // 입력 및 결과 요소
      const inputElem = document.getElementById('result');

      // 에러 메시지 요소
      const errorMessageElem = document.getElementById('errorMessage');

      // 마지막 기호
      let lastSymbol = '';

      function clickNumber(buttonElem) {
        const number = buttonElem.textContent;
        if (number === '0') {
          errorHandler('0으로 시작할 수 없습니다.');
          return;
        }
        inputElem.value += number;
      }

      function clickSymbol(buttonElem) {
        const symbol = buttonElem.textContent;
        const lastchar = inputElem.value.slice(-1);
        if (['+', '-', '*', '/'].includes(lastchar)) {
          console.log('마지막 기호가 연산자입니다.');
          return;
        } else if (symbol === '=') {
          try {
            const calcFunction = new Function('return ' + inputElem.value);
            inputElem.value = calcFunction();
          } catch (error) {
            errorHandler('잘못된 수식입니다');
          }
          return;
        } else if (symbol === 'C') {
          inputElem.value = '';
          return;
        }
        inputElem.value += symbol;
      }

      function errorHandler(errorMessage) {
        errorMessageElem.textContent = errorMessage;
      }
      // function clickSymbol(buttonElem) {
      //   const symbol = buttonElem.textContent;
      //   const lastchar = inputElem.value.slice(-1);
      //   if (['+', '-', '*', '/'].includes(lastchar)) {
      //     console.log('마지막 기호가 연산자입니다.');
      //     return;
      //   } else if (symbol === '=') {
      //     inputElem.value = eval(inputElem.value);
      //     return;
      //   } else if (symbol === 'C') {
      //     inputElem.value = '';
      //     return;
      //   }
      //   inputElem.value += symbol;
      // }
    </script>
  </body>
</html>
