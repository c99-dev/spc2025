from langchain_core.prompts import PromptTemplate
from langchain_openai import OpenAI
from dotenv import load_dotenv

from langchain_core.runnables import RunnableLambda

load_dotenv()

template = (
    "다음의 글을 3문장으로 요약하시오:\n\n예) 1.xxx\n2.xxx\n3.xxx\n\n본문: {article}"
)
prompt = PromptTemplate(
    input_variables=["article"],
    template=template,
)
llm = OpenAI(temperature=0.5)

chain = prompt | llm | RunnableLambda(lambda x: {"summary": x.strip()})

inputs = {
    "article": """
    푸른 눈물 성운
낡은 목재 의자가 삐걱였다. 천문학자 지안은 수십 년째 같은 자리를 지키고 있었다. 돔 형태의 천장이 열리자, 벨벳처럼 부드러운 밤하늘이 그의 작은 천문대를 가득 채웠다. 익숙한 별들이 보석처럼 흩뿌려져 있었지만, 그의 시선은 늘 그 너머, 미지의 심연을 향했다.

젊은 시절, 스승에게서 처음 들었던 '푸른 눈물 성운'. 사진 한 장 없이, 오직 기록으로만 희미하게 존재가 암시되던 그 성운을 찾는 것이 그의 평생소원이었다. 수많은 밤, 커피 향과 함께 하얗게 지새웠지만, 성운은 좀처럼 모습을 드러내지 않았다. 동료들은 하나둘 연구를 포기했고, 어떤 이는 그를 몽상가라 비웃기도 했다. 하지만 지안은 멈출 수 없었다. 그것은 단순한 천체 관측이 아닌, 우주와 나누는 그만의 간절한 대화였기 때문이다.

오늘따라 유난히 대기가 안정적이었다. 지안은 습관처럼 망원경을 조정하고 냉각 CCD 카메라의 데이터를 수집했다. 지루하게 흘러가는 숫자들의 행렬 속에서 무언가를 기대하는 것은 이제 체념에 가까웠다. 그때였다. 모니터 한구석, 아주 미세하지만 분명한 푸른색 파장 데이터가 그의 시선을 붙들었다. 심장이 세차게 고동쳤다. 손가락이 떨려왔다. 수십 년간 반복했던 동작이라고는 믿기지 않을 만큼 더디고 신중하게, 그는 좌표를 미세 조정했다. 장시간 노출을 걸고 숨을 죽였다.

천천히, 아주 천천히 모니터에 형상이 떠오르기 시작했다. 아, 저것은…! 흐릿하지만 틀림없었다. 깊고 영롱한 푸른빛이 마치 거대한 눈물 방울처럼, 우주의 한 자락에서 신비롭게 반짝이고 있었다. 사진으로만 그려왔던 상상 속의 모습보다 훨씬 더 깊고, 훨씬 더 슬프도록 아름다웠다. 지안의 메마른 눈가에 뜨거운 것이 차올랐다. 수십 년의 기다림, 좌절, 그리고 희미한 희망이 파노라마처럼 스쳐 지나갔다.

그는 조용히 중얼거렸다. "드디어… 만났구나." 광활한 우주 속, 티끌 같은 존재인 인간. 하지만 그 작은 존재가 품은 열망은 우주만큼이나 깊고 넓을 수 있음을, 지안은 온몸으로 느끼고 있었다. 푸른 눈물 성운은 마치 그의 오랜 기다림에 화답하듯, 영원의 한 조각을 그의 망막 위에 새겨 넣고 있었다. 밤은 깊어갔지만, 지안의 우주는 그 어느 때보다 찬란하게 빛나고 있었다.
    """
}

result = chain.invoke(inputs)
print("요약결과: ", result["summary"])
